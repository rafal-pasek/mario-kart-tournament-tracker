<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MKTT</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <header>
            <img src="assets/logo.png" alt="Mario Kart Tournament Logo" class="app-logo">
        </header>

        <main class="main-container">
            <div class="card hud-panel unified-card">
                <div class="unified-grid">
                    <!-- Left Column: Controls & Active Race -->
                    <div class="column-left">
                        <!-- Player Registration Section -->
                        <section id="registration" class="inner-panel">
                            <h2>Add Player</h2>
                            <form id="add-player-form">
                                <div class="input-group">
                                    <input type="text" id="player-name" placeholder="Enter player name" required>
                                    <button type="submit" class="btn-primary">Join Tournament</button>
                                </div>
                            </form>

                            <!-- Grand Prix Setup (Visible when players >= 2) -->
                            <div id="gp-setup"
                                style="margin-top: 1.5rem; border-top: 1px solid var(--glass-border); padding-top: 1rem; display: none;">
                                <h3 style="margin-bottom: 1rem;">Grand Prix Setup</h3>
                                <div class="input-group">
                                    <label
                                        style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: -0.25rem;">Controllers
                                        Available</label>
                                    <div class="number-control">
                                        <button class="ctrl-btn"
                                            onclick="adjustValue('controller-count', -1)">‚àí</button>
                                        <input type="number" id="controller-count" value="4" min="1" max="4" readonly>
                                        <button class="ctrl-btn" onclick="adjustValue('controller-count', 1)">+</button>
                                    </div>

                                    <label
                                        style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: -0.25rem; margin-top: 0.5rem;">Number
                                        of Races</label>
                                    <div class="number-control">
                                        <button class="ctrl-btn" onclick="adjustValue('race-count', -1)">‚àí</button>
                                        <input type="text" id="race-count" value="4" readonly
                                            style="font-family: var(--font-main);">
                                        <button class="ctrl-btn" onclick="adjustValue('race-count', 1)">+</button>
                                    </div>
                                    <button class="btn-primary"
                                        onclick="startGrandPrix(parseInt(document.getElementById('controller-count').value), document.getElementById('race-count').value)">Start
                                        Grand Prix</button>
                                </div>
                            </div>
                        </section>

                        <section id="gp-active" class="inner-panel full-width" style="display: none;">
                            <div class="section-header">
                                <h2>Current Race</h2>
                            </div>

                            <div class="scrollable-content">
                                <div id="active-race-view" class="race-card active-race">
                                    <div class="race-header">
                                        <span class="race-badge">RACE <span id="race-number">1</span></span>
                                        <span class="track-name" id="current-track-display"
                                            style="color: var(--text-secondary); font-size: 0.9rem;">Tap winner to
                                            finish
                                            race</span>
                                    </div>
                                    <div class="racers-grid" id="active-racers">
                                        <!-- Populated by JS -->
                                    </div>

                                    <!-- Static Race Actions to prevent layout shift -->
                                    <div id="race-actions"
                                        style="margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem;">
                                        <button id="reset-selection-btn" class="btn-text"
                                            style="visibility: hidden;">Reset
                                            Selection</button>
                                        <button id="confirm-results-btn" class="btn-primary" disabled
                                            style="width: 100%; opacity: 0.5; cursor: not-allowed;">Select 1st
                                            Place</button>
                                    </div>
                                </div>

                                <div class="on-deck-container">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <h3>Up Next</h3>
                                        <button id="end-gp-btn" class="btn-text-danger" style="font-size: 0.8rem;"
                                            onclick="confirmEndGp()">End GP</button>
                                    </div>
                                    <div class="racers-list" id="on-deck-racers">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>

                                <div class="race-stats-container"
                                    style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                                    <h3 style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                        Total Races
                                        Played</h3>
                                    <div class="race-stats-grid" id="race-stats-grid">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Tournament Complete Section -->
                        <section id="tournament-complete" class="inner-panel full-width"
                            style="display: none; text-align: center;">
                            <h2>Tournament Complete! üèÜ</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Check the leaderboard for
                                final standings.</p>
                            <button id="new-tournament-btn" class="btn-primary">Start New Tournament</button>
                        </section>
                    </div> <!-- Close column-left -->

                    <!-- Right Column: Leaderboard -->
                    <div class="column-right">
                        <section id="leaderboard" class="inner-panel full-width">
                            <div class="section-header">
                                <h2>Leaderboard</h2>
                                <button id="reset-btn" class="btn-text" onclick="resetTournament()">Reset All</button>
                            </div>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Rank</th>
                                            <th>Player</th>
                                            <th>Wins</th>
                                            <th>Pts</th>
                                            <th style="width: 40px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="leaderboard-body">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="empty-state" class="empty-state">
                                <p>No players yet.</p>
                            </div>
                        </section>
                    </div>
                </div> <!-- Close unified-grid -->
            </div>
        </main>
    </div>

    <script src="script.js"></script>
</body>

</html>